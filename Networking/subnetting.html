<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetDrill - Networking Study Tool</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Space+Grotesk:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #0a0e17;
  --bg-secondary: #111827;
  --bg-card: #1a2235;
  --bg-card-hover: #1f2a40;
  --border: #2a3650;
  --border-active: #3b82f6;
  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --accent-blue: #3b82f6;
  --accent-cyan: #06b6d4;
  --accent-green: #10b981;
  --accent-amber: #f59e0b;
  --accent-red: #ef4444;
  --accent-purple: #8b5cf6;
  --accent-pink: #ec4899;
  --layer-7: #ec4899;
  --layer-6: #a855f7;
  --layer-5: #8b5cf6;
  --layer-4: #3b82f6;
  --layer-3: #06b6d4;
  --layer-2: #10b981;
  --layer-1: #f59e0b;
  --radius: 8px;
  --radius-lg: 12px;
  --shadow: 0 4px 24px rgba(0,0,0,0.3);
  --transition: 0.2s ease;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Animated grid background */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    linear-gradient(rgba(59,130,246,0.03) 1px, transparent 1px),
    linear-gradient(90deg, rgba(59,130,246,0.03) 1px, transparent 1px);
  background-size: 60px 60px;
  pointer-events: none;
  z-index: 0;
}

.app { position: relative; z-index: 1; }

/* Header */
.header {
  padding: 2rem 2rem 1rem;
  text-align: center;
  border-bottom: 1px solid var(--border);
  background: linear-gradient(180deg, rgba(59,130,246,0.06) 0%, transparent 100%);
}

.header h1 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 2.2rem;
  font-weight: 700;
  letter-spacing: -1px;
  background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue), var(--accent-purple));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 0.25rem;
}

.header p {
  color: var(--text-muted);
  font-size: 0.9rem;
}

/* Tab navigation */
.tabs {
  display: flex;
  justify-content: center;
  gap: 0.5rem;
  padding: 1rem 2rem;
  border-bottom: 1px solid var(--border);
  flex-wrap: wrap;
}

.tab-btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.82rem;
  padding: 0.6rem 1.4rem;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition);
  white-space: nowrap;
}

.tab-btn:hover {
  border-color: var(--accent-blue);
  color: var(--text-primary);
}

.tab-btn.active {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: #fff;
}

/* Main content */
.content {
  max-width: 1100px;
  margin: 0 auto;
  padding: 2rem;
}

.section { display: none; }
.section.active { display: block; animation: fadeIn 0.3s ease; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Section header */
.section-header {
  margin-bottom: 1.5rem;
}

.section-header h2 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.4rem;
  font-weight: 600;
  margin-bottom: 0.3rem;
}

.section-header p {
  color: var(--text-muted);
  font-size: 0.88rem;
}

/* =================== OSI DRAG & DROP =================== */

.osi-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  align-items: start;
}

@media (max-width: 768px) {
  .osi-layout { grid-template-columns: 1fr; }
}

.layer-stack {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.layer-slot {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.7rem 1rem;
  border: 2px dashed var(--border);
  border-radius: var(--radius);
  min-height: 52px;
  transition: all var(--transition);
  position: relative;
}

.layer-slot.drag-over {
  border-color: var(--accent-blue);
  background: rgba(59,130,246,0.08);
}

.layer-slot.correct {
  border-color: var(--accent-green);
  border-style: solid;
  background: rgba(16,185,129,0.08);
}

.layer-slot.incorrect {
  border-color: var(--accent-red);
  border-style: solid;
  background: rgba(239,68,68,0.08);
  animation: shake 0.4s ease;
}

@keyframes shake {
  0%,100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

.layer-num {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  font-weight: 700;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
  color: #fff;
}

.layer-slot-label {
  font-size: 0.85rem;
  color: var(--text-muted);
  font-style: italic;
}

.layer-slot .placed-item {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-primary);
}

/* Drag items pool */
.drag-pool {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 1.25rem;
}

.drag-pool h3 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: 1rem;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.drag-items {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.drag-item {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.82rem;
  padding: 0.5rem 1rem;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 999px;
  cursor: grab;
  transition: all var(--transition);
  user-select: none;
  color: var(--text-primary);
}

.drag-item:hover {
  border-color: var(--accent-blue);
  transform: translateY(-1px);
}

.drag-item:active { cursor: grabbing; }

.drag-item.placed {
  opacity: 0.3;
  pointer-events: none;
}

/* Controls bar */
.controls {
  display: flex;
  gap: 0.75rem;
  margin-top: 1.5rem;
  flex-wrap: wrap;
}

.btn {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.82rem;
  padding: 0.6rem 1.4rem;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  cursor: pointer;
  transition: all var(--transition);
  background: var(--bg-card);
  color: var(--text-primary);
}

.btn:hover { border-color: var(--accent-blue); }

.btn-primary {
  background: var(--accent-blue);
  border-color: var(--accent-blue);
  color: #fff;
}

.btn-primary:hover { background: #2563eb; }

.score-display {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: var(--accent-green);
  display: flex;
  align-items: center;
  margin-left: auto;
}

/* =================== PROTOCOL MATCHING =================== */

.protocol-game {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.protocol-question {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
  transition: all var(--transition);
}

.protocol-question.answered-correct {
  border-color: var(--accent-green);
  background: rgba(16,185,129,0.05);
}

.protocol-question.answered-wrong {
  border-color: var(--accent-red);
  background: rgba(239,68,68,0.05);
}

.pq-prompt {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1rem;
  font-weight: 600;
  margin-bottom: 0.4rem;
}

.pq-hint {
  font-size: 0.82rem;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.pq-options {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.pq-option {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  padding: 0.45rem 1rem;
  border: 1px solid var(--border);
  border-radius: 999px;
  background: var(--bg-secondary);
  color: var(--text-secondary);
  cursor: pointer;
  transition: all var(--transition);
}

.pq-option:hover:not(.disabled) {
  border-color: var(--accent-blue);
  color: var(--text-primary);
}

.pq-option.selected-correct {
  background: var(--accent-green);
  border-color: var(--accent-green);
  color: #fff;
}

.pq-option.selected-wrong {
  background: var(--accent-red);
  border-color: var(--accent-red);
  color: #fff;
}

.pq-option.show-correct {
  border-color: var(--accent-green);
  color: var(--accent-green);
}

.pq-option.disabled { pointer-events: none; }

.pq-explanation {
  margin-top: 0.75rem;
  font-size: 0.82rem;
  color: var(--text-secondary);
  padding: 0.75rem;
  background: rgba(59,130,246,0.06);
  border-radius: var(--radius);
  display: none;
}

.pq-explanation.visible { display: block; animation: fadeIn 0.3s ease; }

/* =================== SUBNETTING =================== */

.subnet-tool {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  align-items: start;
}

@media (max-width: 768px) {
  .subnet-tool { grid-template-columns: 1fr; }
}

.subnet-panel {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 1.5rem;
}

.subnet-panel h3 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.95rem;
  font-weight: 600;
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.input-group {
  margin-bottom: 1rem;
}

.input-group label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  display: block;
  margin-bottom: 0.35rem;
}

.input-group input, .input-group select {
  width: 100%;
  padding: 0.6rem 0.8rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.88rem;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text-primary);
  outline: none;
  transition: border-color var(--transition);
}

.input-group input:focus, .input-group select:focus {
  border-color: var(--accent-blue);
}

.result-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.75rem;
}

.result-item {
  padding: 0.7rem;
  background: var(--bg-secondary);
  border-radius: var(--radius);
  border: 1px solid var(--border);
}

.result-item .ri-label {
  font-size: 0.7rem;
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 0.2rem;
}

.result-item .ri-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  color: var(--accent-cyan);
  word-break: break-all;
}

.result-item.full-width {
  grid-column: 1 / -1;
}

.binary-display {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.78rem;
  padding: 0.75rem;
  background: var(--bg-secondary);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  margin-top: 1rem;
  line-height: 1.8;
  word-break: break-all;
}

.binary-display .octet { color: var(--accent-cyan); }
.binary-display .network-bits { color: var(--accent-green); }
.binary-display .host-bits { color: var(--accent-amber); }
.binary-display .separator { color: var(--text-muted); }

/* Subnet practice */
.practice-prompt {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1rem;
  margin-bottom: 1rem;
}

.practice-prompt .pp-label {
  font-size: 0.7rem;
  font-family: 'JetBrains Mono', monospace;
  color: var(--text-muted);
  text-transform: uppercase;
  margin-bottom: 0.3rem;
}

.practice-prompt .pp-value {
  font-family: 'JetBrains Mono', monospace;
  font-size: 1.1rem;
  color: var(--accent-cyan);
}

.practice-fields {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.practice-field {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.practice-field label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.75rem;
  color: var(--text-muted);
  width: 120px;
  flex-shrink: 0;
}

.practice-field input {
  flex: 1;
  padding: 0.5rem 0.7rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.85rem;
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text-primary);
  outline: none;
  transition: border-color var(--transition);
}

.practice-field input:focus { border-color: var(--accent-blue); }

.practice-field input.correct-input {
  border-color: var(--accent-green);
  background: rgba(16,185,129,0.08);
}

.practice-field input.incorrect-input {
  border-color: var(--accent-red);
  background: rgba(239,68,68,0.08);
}

.practice-feedback {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.82rem;
  padding: 0.75rem;
  border-radius: var(--radius);
  margin-top: 0.5rem;
  display: none;
}

.practice-feedback.visible { display: block; }
.practice-feedback.success {
  background: rgba(16,185,129,0.1);
  color: var(--accent-green);
  border: 1px solid rgba(16,185,129,0.2);
}
.practice-feedback.error {
  background: rgba(239,68,68,0.1);
  color: var(--accent-red);
  border: 1px solid rgba(239,68,68,0.2);
}

/* =================== REFERENCE TABLE =================== */
.ref-table-wrapper {
  overflow-x: auto;
  margin-top: 1rem;
}

.ref-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.82rem;
}

.ref-table th {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.72rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  padding: 0.6rem 0.8rem;
  text-align: left;
  border-bottom: 1px solid var(--border);
  position: sticky;
  top: 0;
  background: var(--bg-card);
}

.ref-table td {
  padding: 0.55rem 0.8rem;
  border-bottom: 1px solid rgba(42,54,80,0.5);
  color: var(--text-secondary);
}

.ref-table tr:hover td {
  background: rgba(59,130,246,0.04);
}

.ref-table .layer-badge {
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.72rem;
  font-weight: 600;
  padding: 0.2rem 0.5rem;
  border-radius: 999px;
  color: #fff;
  white-space: nowrap;
}

.ref-table .proto-name {
  font-family: 'JetBrains Mono', monospace;
  font-weight: 500;
  color: var(--text-primary);
}

/* =================== CIDR CHEAT SHEET =================== */
.cidr-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 0.5rem;
  margin-top: 1rem;
}

.cidr-card {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 0.65rem 0.85rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
}

.cidr-card .cidr-prefix {
  color: var(--accent-cyan);
  font-weight: 600;
}

.cidr-card .cidr-hosts {
  color: var(--text-muted);
  font-size: 0.72rem;
}

/* Responsive */
@media (max-width: 600px) {
  .content { padding: 1rem; }
  .header h1 { font-size: 1.6rem; }
  .osi-layout, .subnet-tool { gap: 1rem; }
  .result-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<div class="app">
  <header class="header">
    <h1>&gt; NetDrill_</h1>
    <p>Interactive networking fundamentals practice</p>
  </header>

  <nav class="tabs">
    <button class="tab-btn active" data-tab="osi-drag">OSI Layers</button>
    <button class="tab-btn" data-tab="protocol-match">Protocol Quiz</button>
    <button class="tab-btn" data-tab="subnet-calc">Subnet Calculator</button>
    <button class="tab-btn" data-tab="subnet-practice">Subnet Practice</button>
    <button class="tab-btn" data-tab="reference">Reference</button>
  </nav>

  <main class="content">

    <!-- ============ OSI DRAG & DROP ============ -->
    <section id="osi-drag" class="section active">
      <div class="section-header">
        <h2>OSI Model Drag &amp; Drop</h2>
        <p>Drag each layer name to its correct position in the stack (Layer 7 = top, Layer 1 = bottom)</p>
      </div>
      <div class="osi-layout">
        <div class="layer-stack" id="layerStack"></div>
        <div class="drag-pool">
          <h3>Layer Names</h3>
          <div class="drag-items" id="dragItems"></div>
        </div>
      </div>
      <div class="controls">
        <button class="btn btn-primary" id="osiCheck">Check Answers</button>
        <button class="btn" id="osiReset">Reset</button>
        <div class="score-display" id="osiScore"></div>
      </div>
    </section>

    <!-- ============ PROTOCOL QUIZ ============ -->
    <section id="protocol-match" class="section">
      <div class="section-header">
        <h2>Protocol &amp; Layer Quiz</h2>
        <p>For each item, select the correct OSI layer or answer</p>
      </div>
      <div class="protocol-game" id="protocolGame"></div>
      <div class="controls">
        <button class="btn" id="protoNew">New Questions</button>
        <div class="score-display" id="protoScore"></div>
      </div>
    </section>

    <!-- ============ SUBNET CALCULATOR ============ -->
    <section id="subnet-calc" class="section">
      <div class="section-header">
        <h2>Subnet Calculator</h2>
        <p>Enter an IP address and CIDR prefix to calculate subnet details</p>
      </div>
      <div class="subnet-tool">
        <div class="subnet-panel">
          <h3>&#9654; Input</h3>
          <div class="input-group">
            <label>IP Address</label>
            <input type="text" id="subnetIp" placeholder="192.168.1.100" value="192.168.1.100">
          </div>
          <div class="input-group">
            <label>CIDR Prefix</label>
            <input type="number" id="subnetCidr" min="0" max="32" value="24" placeholder="/24">
          </div>
          <button class="btn btn-primary" id="subnetCalc" style="width:100%;margin-top:0.5rem;">Calculate</button>

          <div class="binary-display" id="binaryDisplay" style="display:none;"></div>
        </div>
        <div class="subnet-panel">
          <h3>&#9654; Results</h3>
          <div class="result-grid" id="subnetResults">
            <div class="result-item full-width">
              <div class="ri-label">Enter an IP and prefix to see results</div>
            </div>
          </div>
        </div>
      </div>

      <div class="subnet-panel" style="margin-top:2rem;">
        <h3>&#9654; CIDR Cheat Sheet</h3>
        <div class="cidr-grid" id="cidrGrid"></div>
      </div>
    </section>

    <!-- ============ SUBNET PRACTICE ============ -->
    <section id="subnet-practice" class="section">
      <div class="section-header">
        <h2>Subnetting Practice</h2>
        <p>Given a CIDR address, calculate the subnet details by hand</p>
      </div>
      <div class="subnet-tool">
        <div class="subnet-panel">
          <h3>&#9654; Problem</h3>
          <div class="practice-prompt">
            <div class="pp-label">Find the subnet details for:</div>
            <div class="pp-value" id="practiceAddress">--</div>
          </div>
          <div class="practice-fields">
            <div class="practice-field">
              <label>Network Addr</label>
              <input type="text" id="ansNetwork" placeholder="e.g. 10.0.0.0">
            </div>
            <div class="practice-field">
              <label>Broadcast</label>
              <input type="text" id="ansBroadcast" placeholder="e.g. 10.0.0.255">
            </div>
            <div class="practice-field">
              <label>Subnet Mask</label>
              <input type="text" id="ansMask" placeholder="e.g. 255.255.255.0">
            </div>
            <div class="practice-field">
              <label>Usable Hosts</label>
              <input type="number" id="ansHosts" placeholder="e.g. 254">
            </div>
            <div class="practice-field">
              <label>First Usable</label>
              <input type="text" id="ansFirst" placeholder="e.g. 10.0.0.1">
            </div>
            <div class="practice-field">
              <label>Last Usable</label>
              <input type="text" id="ansLast" placeholder="e.g. 10.0.0.254">
            </div>
          </div>
          <div class="controls" style="margin-top:0;">
            <button class="btn btn-primary" id="practiceCheck">Check</button>
            <button class="btn" id="practiceShow">Show Answer</button>
            <button class="btn" id="practiceNew">New Problem</button>
          </div>
          <div class="practice-feedback" id="practiceFeedback"></div>
        </div>
        <div class="subnet-panel">
          <h3>&#9654; Tips</h3>
          <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;">
            <p style="margin-bottom:0.75rem;"><strong style="color:var(--accent-cyan);">Step 1:</strong> Convert the prefix to a subnet mask. Each octet gets 8 bits. /24 = 255.255.255.0</p>
            <p style="margin-bottom:0.75rem;"><strong style="color:var(--accent-cyan);">Step 2:</strong> AND the IP with the mask to find the network address.</p>
            <p style="margin-bottom:0.75rem;"><strong style="color:var(--accent-cyan);">Step 3:</strong> Invert the mask (wildcard) and OR with network address for broadcast.</p>
            <p style="margin-bottom:0.75rem;"><strong style="color:var(--accent-cyan);">Step 4:</strong> Usable hosts = 2^(32 - prefix) - 2 (for /31 and /32, special rules apply).</p>
            <p><strong style="color:var(--accent-cyan);">Step 5:</strong> First usable = network + 1, last usable = broadcast - 1.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ============ REFERENCE TABLE ============ -->
    <section id="reference" class="section">
      <div class="section-header">
        <h2>Quick Reference</h2>
        <p>Common protocols, ports, and their OSI layers</p>
      </div>
      <div class="subnet-panel">
        <div class="ref-table-wrapper">
          <table class="ref-table" id="refTable">
            <thead>
              <tr>
                <th>Protocol</th>
                <th>Port(s)</th>
                <th>Layer</th>
                <th>Transport</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody id="refBody"></tbody>
          </table>
        </div>
      </div>
    </section>

  </main>
</div>

<script>
// =====================================================================
// DATA DEFINITIONS - single source of truth
// =====================================================================

const OSI_LAYERS = [
  { num: 7, name: 'Application',   color: 'var(--layer-7)' },
  { num: 6, name: 'Presentation',  color: 'var(--layer-6)' },
  { num: 5, name: 'Session',       color: 'var(--layer-5)' },
  { num: 4, name: 'Transport',     color: 'var(--layer-4)' },
  { num: 3, name: 'Network',       color: 'var(--layer-3)' },
  { num: 2, name: 'Data Link',     color: 'var(--layer-2)' },
  { num: 1, name: 'Physical',      color: 'var(--layer-1)' },
];

const LAYER_BY_NUM = Object.fromEntries(OSI_LAYERS.map(l => [l.num, l]));

const PROTOCOLS = [
  { name: 'HTTP',    port: '80',     layer: 7, transport: 'TCP', desc: 'Hypertext Transfer Protocol' },
  { name: 'HTTPS',   port: '443',    layer: 7, transport: 'TCP', desc: 'HTTP over TLS' },
  { name: 'FTP',     port: '20/21',  layer: 7, transport: 'TCP', desc: 'File Transfer Protocol' },
  { name: 'SSH',     port: '22',     layer: 7, transport: 'TCP', desc: 'Secure Shell' },
  { name: 'Telnet',  port: '23',     layer: 7, transport: 'TCP', desc: 'Remote terminal (unencrypted)' },
  { name: 'SMTP',    port: '25',     layer: 7, transport: 'TCP', desc: 'Simple Mail Transfer Protocol' },
  { name: 'DNS',     port: '53',     layer: 7, transport: 'TCP/UDP', desc: 'Domain Name System' },
  { name: 'DHCP',    port: '67/68',  layer: 7, transport: 'UDP', desc: 'Dynamic Host Configuration' },
  { name: 'TFTP',    port: '69',     layer: 7, transport: 'UDP', desc: 'Trivial File Transfer Protocol' },
  { name: 'SNMP',    port: '161',    layer: 7, transport: 'UDP', desc: 'Simple Network Mgmt Protocol' },
  { name: 'IMAP',    port: '143',    layer: 7, transport: 'TCP', desc: 'Internet Message Access Protocol' },
  { name: 'POP3',    port: '110',    layer: 7, transport: 'TCP', desc: 'Post Office Protocol v3' },
  { name: 'RDP',     port: '3389',   layer: 7, transport: 'TCP/UDP', desc: 'Remote Desktop Protocol' },
  { name: 'NTP',     port: '123',    layer: 7, transport: 'UDP', desc: 'Network Time Protocol' },
  { name: 'TLS/SSL', port: '--',     layer: 6, transport: '--', desc: 'Encryption & session security' },
  { name: 'JPEG',    port: '--',     layer: 6, transport: '--', desc: 'Image encoding format' },
  { name: 'ASCII',   port: '--',     layer: 6, transport: '--', desc: 'Text encoding' },
  { name: 'NetBIOS', port: '137-139',layer: 5, transport: 'TCP/UDP', desc: 'Session management (legacy)' },
  { name: 'PPTP',    port: '1723',   layer: 5, transport: 'TCP', desc: 'Point-to-Point Tunneling' },
  { name: 'TCP',     port: '--',     layer: 4, transport: '--', desc: 'Transmission Control Protocol' },
  { name: 'UDP',     port: '--',     layer: 4, transport: '--', desc: 'User Datagram Protocol' },
  { name: 'IP',      port: '--',     layer: 3, transport: '--', desc: 'Internet Protocol' },
  { name: 'ICMP',    port: '--',     layer: 3, transport: '--', desc: 'Internet Control Message Protocol' },
  { name: 'ARP',     port: '--',     layer: 3, transport: '--', desc: 'Address Resolution Protocol' },
  { name: 'OSPF',    port: '--',     layer: 3, transport: '--', desc: 'Open Shortest Path First' },
  { name: 'BGP',     port: '179',    layer: 3, transport: 'TCP', desc: 'Border Gateway Protocol' },
  { name: 'Ethernet',port: '--',     layer: 2, transport: '--', desc: 'LAN frame protocol' },
  { name: 'Wi-Fi',   port: '--',     layer: 2, transport: '--', desc: '802.11 wireless LAN' },
  { name: 'PPP',     port: '--',     layer: 2, transport: '--', desc: 'Point-to-Point Protocol' },
  { name: 'MAC',     port: '--',     layer: 2, transport: '--', desc: 'Media Access Control addressing' },
  { name: 'Fiber',   port: '--',     layer: 1, transport: '--', desc: 'Fiber optic cabling' },
  { name: 'DSL',     port: '--',     layer: 1, transport: '--', desc: 'Digital Subscriber Line' },
  { name: 'USB',     port: '--',     layer: 1, transport: '--', desc: 'Universal Serial Bus' },
  { name: 'Bluetooth',port:'--',     layer: 1, transport: '--', desc: 'Short-range wireless' },
];

// Quiz question templates derived from PROTOCOLS
const QUIZ_GENERATORS = [
  {
    id: 'which-layer',
    make: (proto) => ({
      prompt: `Which OSI layer does ${proto.name} operate at?`,
      hint: proto.desc,
      options: OSI_LAYERS.map(l => `L${l.num} ${l.name}`),
      correctIdx: OSI_LAYERS.findIndex(l => l.num === proto.layer),
      explanation: `${proto.name} operates at Layer ${proto.layer} (${LAYER_BY_NUM[proto.layer].name}). ${proto.desc}.`,
    }),
  },
  {
    id: 'which-port',
    filter: (p) => p.port !== '--',
    make: (proto) => {
      const wrong = PROTOCOLS
        .filter(p => p.port !== '--' && p.name !== proto.name)
        .sort(() => Math.random() - 0.5)
        .slice(0, 3)
        .map(p => p.port);
      const options = [...wrong, proto.port].sort(() => Math.random() - 0.5);
      return {
        prompt: `What port does ${proto.name} use?`,
        hint: proto.desc,
        options,
        correctIdx: options.indexOf(proto.port),
        explanation: `${proto.name} uses port ${proto.port}. ${proto.desc}.`,
      };
    },
  },
  {
    id: 'tcp-or-udp',
    filter: (p) => ['TCP', 'UDP'].includes(p.transport),
    make: (proto) => ({
      prompt: `Does ${proto.name} use TCP or UDP?`,
      hint: `Port ${proto.port}`,
      options: ['TCP', 'UDP', 'Both'],
      correctIdx: ['TCP', 'UDP', 'Both'].indexOf(proto.transport),
      explanation: `${proto.name} (port ${proto.port}) uses ${proto.transport}. ${proto.desc}.`,
    }),
  },
];

const QUESTION_COUNT = 6;

// CIDR cheat sheet data - generated, not hardcoded
const CIDR_ENTRIES = Array.from({ length: 25 }, (_, i) => {
  const prefix = 8 + i; // /8 through /32
  const hostBits = 32 - prefix;
  const totalAddresses = Math.pow(2, hostBits);
  const usableHosts = hostBits > 1 ? totalAddresses - 2 : (hostBits === 1 ? 2 : 1);
  return { prefix, totalAddresses, usableHosts };
});

// Practice problem IP ranges
const PRACTICE_PREFIXES = [8, 12, 16, 18, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30];

// =====================================================================
// UTILITIES
// =====================================================================

const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => [...document.querySelectorAll(sel)];

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function ipToInt(ip) {
  return ip.split('.').reduce((acc, oct) => (acc << 8) + parseInt(oct, 10), 0) >>> 0;
}

function intToIp(n) {
  return [n >>> 24, (n >>> 16) & 0xff, (n >>> 8) & 0xff, n & 0xff].join('.');
}

function cidrToMask(prefix) {
  return prefix === 0 ? 0 : (0xffffffff << (32 - prefix)) >>> 0;
}

function intToBinary(n) {
  return Array.from({ length: 4 }, (_, i) => ((n >>> (24 - i * 8)) & 0xff).toString(2).padStart(8, '0'));
}

function calcSubnet(ipStr, prefix) {
  const ip = ipToInt(ipStr);
  const mask = cidrToMask(prefix);
  const network = (ip & mask) >>> 0;
  const broadcast = (network | ~mask) >>> 0;
  const hostBits = 32 - prefix;
  const totalAddresses = Math.pow(2, hostBits);
  const usableHosts = hostBits > 1 ? totalAddresses - 2 : (hostBits === 1 ? 2 : 1);
  const firstUsable = hostBits > 1 ? network + 1 : network;
  const lastUsable = hostBits > 1 ? broadcast - 1 : broadcast;

  return {
    network: intToIp(network),
    broadcast: intToIp(broadcast),
    mask: intToIp(mask),
    wildcard: intToIp(~mask >>> 0),
    usableHosts,
    totalAddresses,
    firstUsable: intToIp(firstUsable),
    lastUsable: intToIp(lastUsable),
    prefix,
    ipBinary: intToBinary(ip),
    maskBinary: intToBinary(mask),
  };
}

function randomIp() {
  const first = [10, 172, 192][Math.floor(Math.random() * 3)];
  const gen = () => Math.floor(Math.random() * 256);
  if (first === 10) return `10.${gen()}.${gen()}.${gen()}`;
  if (first === 172) return `172.${16 + Math.floor(Math.random() * 16)}.${gen()}.${gen()}`;
  return `192.168.${gen()}.${gen()}`;
}

// =====================================================================
// TAB NAVIGATION
// =====================================================================

$$('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    $$('.tab-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    $$('.section').forEach(s => s.classList.remove('active'));
    $(`#${btn.dataset.tab}`).classList.add('active');
  });
});

// =====================================================================
// OSI DRAG & DROP
// =====================================================================

let placedLayers = {};

function renderOsiGame() {
  placedLayers = {};
  const stack = $('#layerStack');
  const pool = $('#dragItems');
  $('#osiScore').textContent = '';

  stack.innerHTML = OSI_LAYERS.map(l => `
    <div class="layer-slot" data-layer="${l.num}"
         ondragover="event.preventDefault(); this.classList.add('drag-over')"
         ondragleave="this.classList.remove('drag-over')"
         ondrop="handleDrop(event, ${l.num})">
      <div class="layer-num" style="background:${l.color}">L${l.num}</div>
      <span class="layer-slot-label">Drop layer name here</span>
    </div>
  `).join('');

  const shuffled = shuffle(OSI_LAYERS);
  pool.innerHTML = shuffled.map(l => `
    <div class="drag-item" draggable="true" data-name="${l.name}"
         ondragstart="event.dataTransfer.setData('text/plain','${l.name}')">${l.name}</div>
  `).join('');
}

window.handleDrop = function(e, slotNum) {
  e.preventDefault();
  const slot = e.currentTarget;
  slot.classList.remove('drag-over');
  const name = e.dataTransfer.getData('text/plain');

  // Remove from previous slot if placed elsewhere
  Object.entries(placedLayers).forEach(([num, val]) => {
    if (val === name) {
      delete placedLayers[num];
      const prevSlot = $(`.layer-slot[data-layer="${num}"]`);
      prevSlot.querySelector('.placed-item')?.remove();
      const label = prevSlot.querySelector('.layer-slot-label');
      if (label) label.style.display = '';
    }
  });

  // Remove existing item in this slot
  if (placedLayers[slotNum]) {
    const oldName = placedLayers[slotNum];
    slot.querySelector('.placed-item')?.remove();
    const oldChip = $(`.drag-item[data-name="${oldName}"]`);
    if (oldChip) oldChip.classList.remove('placed');
  }

  placedLayers[slotNum] = name;
  const label = slot.querySelector('.layer-slot-label');
  if (label) label.style.display = 'none';

  const el = document.createElement('span');
  el.className = 'placed-item';
  el.textContent = name;
  slot.appendChild(el);

  const chip = $(`.drag-item[data-name="${name}"]`);
  if (chip) chip.classList.add('placed');

  // Clear previous styling
  slot.classList.remove('correct', 'incorrect');
};

$('#osiCheck').addEventListener('click', () => {
  let correct = 0;
  OSI_LAYERS.forEach(l => {
    const slot = $(`.layer-slot[data-layer="${l.num}"]`);
    slot.classList.remove('correct', 'incorrect');
    if (placedLayers[l.num] === l.name) {
      slot.classList.add('correct');
      correct++;
    } else if (placedLayers[l.num]) {
      slot.classList.add('incorrect');
    }
  });
  $('#osiScore').textContent = `${correct} / ${OSI_LAYERS.length} correct`;
});

$('#osiReset').addEventListener('click', renderOsiGame);

// =====================================================================
// PROTOCOL QUIZ
// =====================================================================

function generateQuestions() {
  const questions = [];
  const maxAttempts = 100;
  let attempts = 0;

  while (questions.length < QUESTION_COUNT && attempts < maxAttempts) {
    attempts++;
    const gen = QUIZ_GENERATORS[Math.floor(Math.random() * QUIZ_GENERATORS.length)];
    const candidates = PROTOCOLS.filter(gen.filter || (() => true));
    const proto = candidates[Math.floor(Math.random() * candidates.length)];

    const key = `${gen.id}-${proto.name}`;
    if (questions.some(q => q.key === key)) continue;

    const q = gen.make(proto);
    q.key = key;
    questions.push(q);
  }

  return questions;
}

let quizQuestions = [];
let quizAnswered = 0;
let quizCorrect = 0;

function renderProtocolQuiz() {
  quizQuestions = generateQuestions();
  quizAnswered = 0;
  quizCorrect = 0;
  $('#protoScore').textContent = '';

  $('#protocolGame').innerHTML = quizQuestions.map((q, qi) => `
    <div class="protocol-question" id="pq-${qi}">
      <div class="pq-prompt">${q.prompt}</div>
      <div class="pq-hint">${q.hint}</div>
      <div class="pq-options">
        ${q.options.map((opt, oi) => `
          <button class="pq-option" data-qi="${qi}" data-oi="${oi}" onclick="handleQuizAnswer(${qi},${oi})">${opt}</button>
        `).join('')}
      </div>
      <div class="pq-explanation" id="pqe-${qi}">${q.explanation}</div>
    </div>
  `).join('');
}

window.handleQuizAnswer = function(qi, oi) {
  const q = quizQuestions[qi];
  const container = $(`#pq-${qi}`);
  const buttons = container.querySelectorAll('.pq-option');
  const isCorrect = oi === q.correctIdx;

  quizAnswered++;
  if (isCorrect) quizCorrect++;

  buttons.forEach((btn, i) => {
    btn.classList.add('disabled');
    if (i === q.correctIdx) btn.classList.add(i === oi ? 'selected-correct' : 'show-correct');
    if (i === oi && !isCorrect) btn.classList.add('selected-wrong');
  });

  container.classList.add(isCorrect ? 'answered-correct' : 'answered-wrong');
  $(`#pqe-${qi}`).classList.add('visible');

  $('#protoScore').textContent = `${quizCorrect} / ${quizAnswered} correct`;
};

$('#protoNew').addEventListener('click', renderProtocolQuiz);

// =====================================================================
// SUBNET CALCULATOR
// =====================================================================

$('#subnetCalc').addEventListener('click', () => {
  const ipStr = $('#subnetIp').value.trim();
  const prefix = parseInt($('#subnetCidr').value, 10);

  if (!/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/.test(ipStr)) return;
  if (isNaN(prefix) || prefix < 0 || prefix > 32) return;

  const r = calcSubnet(ipStr, prefix);

  const RESULT_FIELDS = [
    { label: 'Network Address',  value: r.network },
    { label: 'Broadcast Address',value: r.broadcast },
    { label: 'Subnet Mask',      value: r.mask },
    { label: 'Wildcard Mask',    value: r.wildcard },
    { label: 'Usable Hosts',     value: r.usableHosts.toLocaleString() },
    { label: 'Total Addresses',  value: r.totalAddresses.toLocaleString() },
    { label: 'First Usable',     value: r.firstUsable },
    { label: 'Last Usable',      value: r.lastUsable },
  ];

  $('#subnetResults').innerHTML = RESULT_FIELDS.map(f => `
    <div class="result-item">
      <div class="ri-label">${f.label}</div>
      <div class="ri-value">${f.value}</div>
    </div>
  `).join('');

  // Binary display
  const bd = $('#binaryDisplay');
  bd.style.display = 'block';
  const ipBin = r.ipBinary.join('.');
  const maskBin = r.maskBinary.join('.');
  const netBits = ipBin.replace(/\./g, '').slice(0, prefix);
  const hostBits = ipBin.replace(/\./g, '').slice(prefix);

  bd.innerHTML = `
    <div><strong style="color:var(--text-muted);width:60px;display:inline-block;">IP:</strong>
      <span class="network-bits">${netBits.match(/.{1,8}/g)?.join('<span class="separator">.</span>') || ''}</span><span class="host-bits">${hostBits.match(/.{1,8}/g)?.map((s,i) => (i===0 && netBits.length % 8 !== 0 ? '' : '<span class="separator">.</span>') + s).join('') || ''}</span>
    </div>
    <div><strong style="color:var(--text-muted);width:60px;display:inline-block;">Mask:</strong>
      <span class="octet">${maskBin}</span>
    </div>
    <div style="margin-top:0.4rem;font-size:0.7rem;color:var(--text-muted);">
      <span class="network-bits">&#9632; network (${prefix} bits)</span> &nbsp;
      <span class="host-bits">&#9632; host (${32 - prefix} bits)</span>
    </div>
  `;
});

// CIDR cheat sheet
$('#cidrGrid').innerHTML = CIDR_ENTRIES.map(e => `
  <div class="cidr-card">
    <span class="cidr-prefix">/${e.prefix}</span>
    <span class="cidr-hosts">${e.usableHosts.toLocaleString()} hosts</span>
  </div>
`).join('');

// =====================================================================
// SUBNET PRACTICE
// =====================================================================

let practiceAnswer = null;

function newPractice() {
  const ip = randomIp();
  const prefix = PRACTICE_PREFIXES[Math.floor(Math.random() * PRACTICE_PREFIXES.length)];
  practiceAnswer = calcSubnet(ip, prefix);
  $('#practiceAddress').textContent = `${ip} /${prefix}`;

  ['ansNetwork','ansBroadcast','ansMask','ansHosts','ansFirst','ansLast'].forEach(id => {
    const el = $(`#${id}`);
    el.value = '';
    el.classList.remove('correct-input', 'incorrect-input');
  });

  const fb = $('#practiceFeedback');
  fb.classList.remove('visible', 'success', 'error');
}

const PRACTICE_FIELDS = [
  { id: 'ansNetwork',   key: 'network' },
  { id: 'ansBroadcast', key: 'broadcast' },
  { id: 'ansMask',      key: 'mask' },
  { id: 'ansHosts',     key: 'usableHosts', transform: v => parseInt(v, 10) },
  { id: 'ansFirst',     key: 'firstUsable' },
  { id: 'ansLast',      key: 'lastUsable' },
];

$('#practiceCheck').addEventListener('click', () => {
  if (!practiceAnswer) return;

  let allCorrect = true;

  PRACTICE_FIELDS.forEach(({ id, key, transform }) => {
    const el = $(`#${id}`);
    const userVal = transform ? transform(el.value.trim()) : el.value.trim();
    const correctVal = typeof practiceAnswer[key] === 'number' ? practiceAnswer[key] : practiceAnswer[key];
    const isCorrect = String(userVal) === String(correctVal);

    el.classList.remove('correct-input', 'incorrect-input');
    el.classList.add(isCorrect ? 'correct-input' : 'incorrect-input');
    if (!isCorrect) allCorrect = false;
  });

  const fb = $('#practiceFeedback');
  fb.classList.add('visible');
  fb.classList.remove('success', 'error');
  fb.classList.add(allCorrect ? 'success' : 'error');
  fb.textContent = allCorrect ? 'All correct!' : 'Some answers need fixing. Check the highlighted fields.';
});

$('#practiceShow').addEventListener('click', () => {
  if (!practiceAnswer) return;

  PRACTICE_FIELDS.forEach(({ id, key }) => {
    const el = $(`#${id}`);
    el.value = practiceAnswer[key];
    el.classList.remove('incorrect-input');
    el.classList.add('correct-input');
  });

  const fb = $('#practiceFeedback');
  fb.classList.add('visible', 'success');
  fb.classList.remove('error');
  fb.textContent = 'Answers revealed above.';
});

$('#practiceNew').addEventListener('click', newPractice);

// =====================================================================
// REFERENCE TABLE
// =====================================================================

$('#refBody').innerHTML = PROTOCOLS.map(p => `
  <tr>
    <td class="proto-name">${p.name}</td>
    <td>${p.port}</td>
    <td><span class="layer-badge" style="background:${LAYER_BY_NUM[p.layer].color}">L${p.layer} ${LAYER_BY_NUM[p.layer].name}</span></td>
    <td>${p.transport}</td>
    <td>${p.desc}</td>
  </tr>
`).join('');

// =====================================================================
// INIT
// =====================================================================

renderOsiGame();
renderProtocolQuiz();
newPractice();

// Trigger initial subnet calc
$('#subnetCalc').click();
</script>

</body>
</html>
